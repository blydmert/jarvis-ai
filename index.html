<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        @keyframes pulseSpeaking {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.3); opacity: 1; }
        }
        body { margin: 0; overflow: hidden; }
        
        elevenlabs-convai {
            position: fixed !important;
            bottom: 100px !important;
            right: 50% !important;
            transform: translateX(50%) !important;
            z-index: 1000 !important;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #22d3ee; border-radius: 4px; }
        
        .history-scroll::-webkit-scrollbar { width: 6px; }
        .history-scroll::-webkit-scrollbar-thumb { background: #06b6d4; }
    </style>
</head>
<body class="bg-black text-white font-sans">
    <elevenlabs-convai agent-id="agent_0801k81tqg2dfe5s7rc61ze480bn"></elevenlabs-convai>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>

    <div id="app" class="relative w-full h-screen overflow-hidden">
        <!-- Background grid -->
        <div class="absolute inset-0 opacity-10">
            <div class="absolute inset-0" style="background-image: linear-gradient(rgba(0, 200, 255, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 200, 255, 0.3) 1px, transparent 1px); background-size: 50px 50px;"></div>
        </div>

        <!-- Top Bar -->
        <div class="absolute top-0 left-0 right-0 flex items-center justify-between p-6 z-10">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center">
                    <div class="w-8 h-8 border-2 border-white rounded transform rotate-45"></div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="flex gap-1">
                        <div class="w-2 h-2 bg-cyan-400 rounded-full" style="animation: pulse 1.5s ease-in-out infinite;"></div>
                        <div class="w-2 h-2 bg-cyan-400 rounded-full" style="animation: pulse 1.5s ease-in-out infinite; animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-cyan-400 rounded-full" style="animation: pulse 1.5s ease-in-out infinite; animation-delay: 0.4s;"></div>
                    </div>
                    <h1 class="text-4xl font-bold text-cyan-400 tracking-wider">JARVIS</h1>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <div id="status-dot" class="w-2 h-2 rounded-full bg-green-400" style="animation: pulse 1.5s ease-in-out infinite;"></div>
                    <span class="text-gray-400 text-sm">Online</span>
                </div>
                <button onclick="toggleHistory()" class="p-2 hover:bg-cyan-500/20 rounded transition-colors cursor-pointer" title="Konu≈üma Ge√ßmi≈üi">
                    <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
                <button onclick="toggleSettings()" class="p-2 hover:bg-cyan-500/20 rounded transition-colors cursor-pointer">
                    <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Main Orb Canvas -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <canvas id="orbCanvas" width="800" height="800" class="max-w-full max-h-full"></canvas>
        </div>

        <!-- HUD Elements -->
        <div class="absolute top-1/2 right-8 transform -translate-y-1/2 text-right space-y-2">
            <div class="text-cyan-400 text-xs opacity-70">SYS_STATUS: <span id="sys-status" class="text-cyan-300">OPTIMAL</span></div>
            <div class="text-cyan-400 text-xs opacity-70">CORE_TEMP: <span class="text-cyan-300">36.2¬∞C</span></div>
            <div class="text-cyan-400 text-xs opacity-70">CONV_COUNT: <span id="conv-count" class="text-cyan-300">0</span></div>
            <div class="text-cyan-400 text-xs opacity-70">
                <div class="w-32 h-1 bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-cyan-400 transition-all duration-300" id="activity-bar" style="width: 78%;"></div>
                </div>
            </div>
        </div>

        <!-- Left side tech display -->
        <div class="absolute left-8 top-1/2 transform -translate-y-1/2 space-y-4">
            <div class="text-cyan-400 text-xs opacity-50">
                <div>JARVIS</div>
                <div>v3.0.7 // Online</div>
                <div id="n8n-status" class="mt-2"></div>
            </div>
            <div class="w-24 h-24 border border-cyan-500/30 rounded-lg relative">
                <div class="absolute inset-2 border border-cyan-500/50"></div>
                <div id="center-dot" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-1 h-1 bg-cyan-400 rounded-full"></div>
            </div>
        </div>

        <!-- Messages Display -->
        <div id="messages-container" class="absolute top-24 left-1/2 transform -translate-x-1/2 w-full max-w-2xl px-4 max-h-96 overflow-y-auto">
            <div id="messages" class="space-y-2"></div>
        </div>

        <!-- Instruction Text -->
        <div class="absolute bottom-32 left-1/2 transform -translate-x-1/2 text-center">
            <div class="text-cyan-400 text-sm font-light tracking-wider opacity-70">
                TAP THE BUTTON BELOW TO SPEAK WITH JARVIS
            </div>
        </div>

        <!-- History Modal -->
        <div id="history-modal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-900 border-2 border-cyan-500 rounded-lg p-6 max-w-2xl w-full max-h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-cyan-400">KONU≈ûMA GE√áMƒ∞≈ûƒ∞</h2>
                    <div class="flex gap-2">
                        <button onclick="exportHistory()" class="text-cyan-400 hover:text-cyan-300 transition-colors p-2 cursor-pointer" title="Export JSON">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                        </button>
                        <button onclick="clearHistory()" class="text-red-400 hover:text-red-300 transition-colors p-2 cursor-pointer" title="Ge√ßmi≈üi Temizle">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                        <button onclick="toggleHistory()" class="text-gray-400 hover:text-cyan-400 transition-colors cursor-pointer">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div id="history-content" class="flex-1 overflow-y-auto history-scroll space-y-3 pr-2">
                    <div class="text-center text-gray-500 py-8">Konu≈üma ge√ßmi≈üi y√ºkleniyor...</div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-900 border-2 border-cyan-500 rounded-lg p-6 max-w-md w-full">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-cyan-400">AYARLAR</h2>
                    <button onclick="toggleSettings()" class="text-gray-400 hover:text-cyan-400 transition-colors cursor-pointer">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="flex items-center gap-2 text-cyan-400 text-sm font-medium mb-2 cursor-pointer">
                            <input type="checkbox" id="n8n-enabled" onchange="toggleN8N()" class="w-4 h-4 rounded border-cyan-500 bg-gray-800 text-cyan-500 focus:ring-cyan-500 cursor-pointer">
                            <span>n8n Entegrasyonu Aktif</span>
                        </label>
                        <input type="text" id="webhook-input" class="w-full bg-gray-800 border border-cyan-500/30 rounded px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-400 text-sm disabled:opacity-50 disabled:cursor-not-allowed" placeholder="https://your-n8n.com/webhook/n8n" disabled>
                        <p class="text-gray-500 text-xs mt-1">‚ö° Aktif olduƒüunda AI yanƒ±tlarƒ± n8n'den gelir</p>
                    </div>

                    <div>
                        <label class="block text-cyan-400 text-sm font-medium mb-2">ElevenLabs Agent ID</label>
                        <input type="text" id="agent-id-input" class="w-full bg-gray-800 border border-cyan-500/30 rounded px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-400 text-sm" value="agent_0801k81tqg2dfe5s7rc61ze480bn">
                    </div>

                    <div class="bg-cyan-500/10 border border-cyan-500/30 rounded p-3">
                        <p class="text-cyan-300 text-xs leading-relaxed">
                            <strong>üí° n8n nasƒ±l √ßalƒ±≈üƒ±r:</strong><br>
                            ‚úì Checkbox'ƒ± i≈üaretleyin<br>
                            ‚úì Webhook URL girin<br>
                            ‚úì n8n, AI yanƒ±tlarƒ±nƒ± kontrol eder<br>
                            ‚úì Sol panelde durum g√∂r√ºn√ºr
                        </p>
                    </div>

                    <button onclick="saveSettings()" class="w-full bg-cyan-500 text-white font-medium py-2 rounded hover:bg-cyan-600 transition-colors cursor-pointer">
                        KAYDET VE KAPAT
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('‚úÖ JARVIS v3.0.7 Ba≈ülatƒ±lƒ±yor...');
        
        let webhookUrl = localStorage.getItem('webhookUrl') || '';
        let agentId = localStorage.getItem('agentId') || 'agent_0801k81tqg2dfe5s7rc61ze480bn';
        let n8nEnabled = localStorage.getItem('n8nEnabled') === 'true';
        let messages = [];
        let conversationHistory = JSON.parse(localStorage.getItem('conversationHistory') || '[]');
        let isSpeaking = false;
        let conversationCount = conversationHistory.length;
        let currentConversation = [];

        // Load settings
        document.getElementById('webhook-input').value = webhookUrl;
        document.getElementById('agent-id-input').value = agentId;
        document.getElementById('n8n-enabled').checked = n8nEnabled;
        document.getElementById('webhook-input').disabled = !n8nEnabled;
        document.getElementById('conv-count').textContent = conversationCount;
        updateN8NStatus();

        // Orb Animation
        const canvas = document.getElementById('orbCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = 400, centerY = 400;
        let angle = 0, pulsePhase = 0;
        let targetPulse = 80, currentPulse = 80;

        function drawOrb() {
            ctx.clearRect(0, 0, 800, 800);
            pulsePhase += isSpeaking ? 0.08 : 0.02;
            targetPulse = isSpeaking ? 120 : 80;
            currentPulse += (targetPulse - currentPulse) * 0.1;
            
            const pulse = Math.sin(pulsePhase) * (isSpeaking ? 20 : 10) + currentPulse;
            
            const ringCount = isSpeaking ? 6 : 4;
            for (let i = ringCount; i > 0; i--) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, pulse + (i * 40), 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(0, 200, 255, ${(isSpeaking ? 0.15 : 0.1) / i})`;
                ctx.lineWidth = isSpeaking ? 3 : 2;
                ctx.stroke();
            }
            
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, pulse);
            gradient.addColorStop(0, isSpeaking ? 'rgba(34, 211, 238, 1)' : 'rgba(0, 240, 255, 1)');
            gradient.addColorStop(0.5, isSpeaking ? 'rgba(6, 182, 212, 0.8)' : 'rgba(0, 180, 255, 0.5)');
            gradient.addColorStop(1, 'rgba(0, 80, 255, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 800);
            
            angle += isSpeaking ? 0.015 : 0.005;
            const segmentCount = isSpeaking ? 16 : 8;
            for (let i = 0; i < segmentCount; i++) {
                const a = (Math.PI * 2 / segmentCount) * i + angle;
                const distance = pulse + (isSpeaking ? 120 : 100);
                const x2 = centerX + Math.cos(a) * distance;
                const y2 = centerY + Math.sin(a) * distance;
                
                ctx.beginPath();
                ctx.arc(x2, y2, isSpeaking ? 3 : 2, 0, Math.PI * 2);
                ctx.fillStyle = isSpeaking ? 'rgba(34, 211, 238, 0.9)' : 'rgba(0, 200, 255, 0.6)';
                ctx.fill();
            }
            
            requestAnimationFrame(drawOrb);
        }
        drawOrb();

        function toggleN8N() {
            const enabled = document.getElementById('n8n-enabled').checked;
            document.getElementById('webhook-input').disabled = !enabled;
        }

        function updateN8NStatus() {
            const statusEl = document.getElementById('n8n-status');
            if (n8nEnabled && webhookUrl) {
                statusEl.textContent = 'n8n: ACTIVE';
                statusEl.className = 'mt-2 text-green-400 text-xs';
            } else if (n8nEnabled) {
                statusEl.textContent = 'n8n: NO URL';
                statusEl.className = 'mt-2 text-yellow-400 text-xs';
            } else {
                statusEl.textContent = 'n8n: DISABLED';
                statusEl.className = 'mt-2 text-gray-500 text-xs';
            }
        }

        function toggleSettings() {
            document.getElementById('settings-modal').classList.toggle('hidden');
        }

        function toggleHistory() {
            const modal = document.getElementById('history-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                renderHistory();
            }
        }

        function renderHistory() {
            const container = document.getElementById('history-content');
            if (conversationHistory.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Hen√ºz konu≈üma ge√ßmi≈üi yok</div>';
                return;
            }
            
            container.innerHTML = conversationHistory.map((conv, idx) => `
                <div class="bg-gray-800/50 border border-cyan-500/20 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div class="text-cyan-400 text-sm font-medium">#${idx + 1} - ${new Date(conv.timestamp).toLocaleString('tr-TR')}</div>
                        <button onclick="deleteConversation(${idx})" class="text-red-400 hover:text-red-300 text-xs cursor-pointer">Sil</button>
                    </div>
                    <div class="space-y-2">
                        ${conv.messages.map(msg => `
                            <div class="text-sm">
                                <span class="font-medium ${msg.sender === 'user' ? 'text-cyan-300' : 'text-blue-300'}">${msg.sender === 'user' ? 'Sƒ∞Z' : 'JARVIS'}:</span>
                                <span class="text-gray-300 ml-2">${msg.text}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function deleteConversation(index) {
            if (confirm('Bu konu≈ümayƒ± silmek istediƒüinizden emin misiniz?')) {
                conversationHistory.splice(index, 1);
                localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
                conversationCount = conversationHistory.length;
                document.getElementById('conv-count').textContent = conversationCount;
                renderHistory();
                addMessage('üóëÔ∏è Konu≈üma silindi', 'system');
            }
        }

        function clearHistory() {
            if (confirm('T√ºm konu≈üma ge√ßmi≈üini silmek istediƒüinizden emin misiniz?')) {
                conversationHistory = [];
                localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
                conversationCount = 0;
                document.getElementById('conv-count').textContent = conversationCount;
                renderHistory();
                addMessage('üóëÔ∏è T√ºm ge√ßmi≈ü silindi', 'system');
            }
        }

        function exportHistory() {
            if (conversationHistory.length === 0) {
                alert('Hen√ºz dƒ±≈üa aktarƒ±lacak konu≈üma yok!');
                return;
            }
            const dataStr = JSON.stringify(conversationHistory, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `jarvis-history-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            addMessage('üì• Ge√ßmi≈ü indirildi', 'system');
        }

        function saveSettings() {
            n8nEnabled = document.getElementById('n8n-enabled').checked;
            webhookUrl = document.getElementById('webhook-input').value;
            agentId = document.getElementById('agent-id-input').value;
            
            localStorage.setItem('n8nEnabled', n8nEnabled);
            localStorage.setItem('webhookUrl', webhookUrl);
            localStorage.setItem('agentId', agentId);
            
            const widget = document.querySelector('elevenlabs-convai');
            if (widget && agentId) {
                widget.setAttribute('agent-id', agentId);
            }
            
            updateN8NStatus();
            toggleSettings();
            addMessage('‚úÖ Ayarlar kaydedildi', 'system');
        }

        window.addEventListener('message', async (event) => {
            if (event.data) {
                console.log('üì® Widget:', event.data);
                
                if (event.data.type === 'transcript' || event.data.userMessage) {
                    const userText = event.data.transcript || event.data.userMessage || event.data.text;
                    if (userText) {
                        addMessage(userText, 'user');
                        currentConversation.push({ sender: 'user', text: userText, timestamp: new Date() });
                        
                        if (n8nEnabled && webhookUrl) {
                            const n8nResponse = await sendToN8N(userText, 'user');
                            if (n8nResponse) {
                                isSpeaking = true;
                                document.getElementById('center-dot').style.animation = 'pulseSpeaking 0.8s ease-in-out infinite';
                                addMessage(n8nResponse, 'jarvis');
                                currentConversation.push({ sender: 'jarvis', text: n8nResponse, timestamp: new Date() });
                                setTimeout(() => {
                                    isSpeaking = false;
                                    document.getElementById('center-dot').style.animation = '';
                                }, 2000);
                            }
                        }
                    }
                }
                
                if ((event.data.type === 'response' || event.data.agentMessage) && (!n8nEnabled || !webhookUrl)) {
                    const agentText = event.data.response || event.data.agentMessage || event.data.text;
                    if (agentText) {
                        isSpeaking = true;
                        document.getElementById('center-dot').style.animation = 'pulseSpeaking 0.8s ease-in-out infinite';
                        addMessage(agentText, 'jarvis');
                        currentConversation.push({ sender: 'jarvis', text: agentText, timestamp: new Date() });
                        setTimeout(() => {
                            isSpeaking = false;
                            document.getElementById('center-dot').style.animation = '';
                        }, 2000);
                    }
                }
                
                if (event.data.type === 'conversation-started') {
                    document.getElementById('sys-status').textContent = 'ACTIVE';
                    document.getElementById('activity-bar').style.width = '100%';
                    currentConversation = [];
                    addMessage('üé§ Konu≈üma ba≈üladƒ±', 'system');
                }
                
                if (event.data.type === 'conversation-ended') {
                    document.getElementById('sys-status').textContent = 'OPTIMAL';
                    document.getElementById('activity-bar').style.width = '78%';
                    if (currentConversation.length > 0) {
                        conversationHistory.push({
                            timestamp: new Date(),
                            messages: currentConversation
                        });
                        localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
                        conversationCount = conversationHistory.length;
                        document.getElementById('conv-count').textContent = conversationCount;
                    }
                    addMessage('‚úÖ Konu≈üma sonlandƒ±', 'system');
                }
            }
        });

        async function sendToN8N(text, sender) {
            if (!n8nEnabled || !webhookUrl) return null;

            try {
                console.log('üì§ n8n\'e g√∂nderiliyor:', { text, sender });
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        sender: sender,
                        timestamp: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ n8n yanƒ±tƒ±:', data);
                    return data.response || data.message || data.output || null;
                }
            } catch (error) {
                console.error('‚ùå n8n hatasƒ±:', error);
                addMessage('‚ö†Ô∏è n8n baƒülantƒ± hatasƒ±', 'system');
            }
            return null;
        }

        function addMessage(text, sender) {
            messages.push({ text, sender, timestamp: new Date() });
            if (messages.length > 10) messages.shift();
            
            const container = document.getElementById('messages');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'text-center';
                div.style.animation = 'fadeIn 0.5s ease-out';
                
                let colorClass = '';
                let label = '';
                if (msg.sender === 'user') {
                    colorClass = 'text-cyan-300';
                    label = 'USER';
                } else if (msg.sender === 'jarvis') {
                    colorClass = 'text-blue-300';
                    label = 'JARVIS';
                } else {
                    colorClass = 'text-gray-500';
                    label = 'SYSTEM';
                }
                
                div.innerHTML = `
                    <div class="text-xs opacity-70 mb-1">${label}</div>
                    <div class="text-base font-light ${colorClass}">${text}</div>
                `;
                
                container.appendChild(div);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        setTimeout(() => {
            const widget = document.querySelector('elevenlabs-convai');
            if (widget) {
                console.log('‚úÖ ElevenLabs widget y√ºklendi');
                addMessage('üéôÔ∏è JARVIS hazƒ±r! Alt taraftaki butona basarak konu≈ümaya ba≈ülayƒ±n.', 'system');
            } else {
                console.warn('‚ö†Ô∏è ElevenLabs widget y√ºklenemedi');
                addMessage('‚ö†Ô∏è Ses widget\'ƒ± y√ºklenemedi. Sayfayƒ± yenileyin.', 'system');
            }
        }, 2000);

        console.log('‚úÖ JARVIS v3.0.7 ba≈ülatƒ±ldƒ±!');
        console.log('üìä Konu≈üma sayƒ±sƒ±:', conversationCount);
        console.log('üîó n8n durumu:', n8nEnabled ? 'Aktif' : 'Pasif');
    </script>
</body>
</html>